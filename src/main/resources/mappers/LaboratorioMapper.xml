<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.registerLab.mappers.LaboratorioMapper">

	<!-- 
	Example consulta
	Select id as id_laboratorio form laboratorio where ....
	
	 -->
	 
	 <select id="getLaboratorios" resultMap="LaboratorioResult">
		SELECT laboratorio.id as id_laboratorio,laboratorio.nombre,laboratorio.capacidad,laboratorio.fechacierre,equipo.id
		FROM laboratorio left join equipo on laboratorio.id=equipo.laboratorio
	</select>
	
	 <insert parameterType="map" id="agregarLaboratorio">
	 	insert into laboratorio (id,nombre,capacidad,fechacierre) 
	 	values (#{Id},#{Nom},#{capacidad},#{fecha}) 
	 </insert>
	 
	 <update parameterType="map" id="asociarEquipo">
    	UPDATE equipo set laboratorio = #{laboratorio}
    	where id = #{equipo}
    </update>
    
    <select parameterType="map" id="getLaboratorios" resultMap="LaboratorioResult">
    	select id, nombre, capacidad,fechacierre from laboratorio 
    </select>
    
    <select parameterType="map" id="getLaboratorio" resultMap="LaboratorioResult">
    	select laboratorio.id, laboratorio.nombre, laboratorio.capacidad,laboratorio.fechacierre
    	,equipo.id,equipo.fechainicioactividad,equipo.fechafinactividad,equipo.fechaadquisicion    	
    	from laboratorio left join equipo on laboratorio.id = equipo.laboratorio
    	where laboratorio.id = #{Id} 
    </select>
    
	<resultMap type='Laboratorio' id='LaboratorioResult'>
	    <id property='id' column='id_laboratorio'/>
	    <result property="nombre" column="nombre"></result>
	    <result property="capacidad" column="capacidad"></result>
	    <result property="fechaCierre" column="fechacierre"></result>
	    <collection property="equipos" resultMap="com.registerLab.mappers.EquipoMapper.EquipoResult"/>       
	</resultMap>
	
</mapper>